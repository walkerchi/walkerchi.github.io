(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[643],{71661:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[lang]/function/wqrcode",function(){return n(71477)}])},71477:function(t,e,n){"use strict";n.r(e),n.d(e,{__N_SSG:function(){return w},default:function(){return _}});var r=n(85893),o=n(67294),i=n(70582),a=n(33345),c=n(92592),u=n(65616),l=n.n(u),s={outline:{color:"#FF3B58"},buttons:{camera:{name:"camera"},upload:{name:"upload"}}},d=n(5401),h=n.n(d);function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(u){c=!0,o=u}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(!t)return;if("string"===typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(){var t=m(o.useState("walkerchi"),2),e=t[0],n=t[1],u=m(o.useState(!1),2),d=u[0],f=u[1],g=(0,i.T_)("function.wqrcode"),w=o.useRef(null),_=o.useRef(null),v=o.useRef(null),y=o.useRef(null),b=o.useRef(null),p=o.useRef(null);return o.useEffect((function(){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame}),[]),o.useEffect((function(){c.toCanvas(w.current,e,{version:8,errorCorrectionLevel:"M"},(function(t){t?console.error(t):console.log("success!")}))}),[e]),(0,r.jsxs)("div",{className:h().wqrcode,children:[(0,r.jsxs)("div",{className:h().container,children:[(0,r.jsxs)("div",{className:"".concat(h().buttons," ").concat(d?h()["using-camera"]:""),children:[(0,r.jsx)("div",{className:h()["camera-button"],onClick:function(){if(d){console.log(p.current.getTracks()),p.current.getTracks()[0].stop(),window.cancelAnimationFrame(b.current),_.current.getContext("2d").clearRect(0,0,_.current.width,_.current.height)}else{var t=_.current.getContext("2d");function e(e,n,r){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.lineWidth=4,t.strokeStyle=r,t.stroke()}function r(){if(v.readyState===v.HAVE_ENOUGH_DATA){_.current.height=v.current.offsetHeight,_.current.width=v.current.offsetWidth,t.drawImage(v.current,0,0,_.current.width,_.current.height);var o=t.getImageData(0,0,_.current.width,_.current.height),i=l()(o.data,o.width,o.height,{inversionAttempts:"dontInvert"});i&&(e(i.location.topLeftCorner,i.location.topRightCorner,s.outline.color),e(i.location.topRightCorner,i.location.bottomRightCorner,s.outline.color),e(i.location.bottomRightCorner,i.location.bottomLeftCorner,s.outline.color),e(i.location.bottomLeftCorner,i.location.topLeftCorner,s.outline.color),n(i.data))}b.current=requestAnimationFrame(r)}navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:500,height:500},audio:!1}).then((function(t){v.current.srcObject=t,p.current=t,b.current=requestAnimationFrame(r)}))}f((function(t){return!t}))},children:g(s.buttons.camera.name)}),(0,r.jsxs)("div",{className:h()["upload-button"],children:[(0,r.jsx)("input",{type:"file",name:"qrcode",accept:"image/*",ref:y,onChange:function(){d||function(){var t=y.current.files[0],e=new FileReader;e.readAsDataURL(t),e.onload=function(){var t=w.current.getContext("2d"),e=new Image;e.src=this.result,e.onload=function(){t.clearRect(0,0,w.current.width,w.current.height);var r=function(t,e,n,r){var o=1,i="none",a={width:t,height:e,scale:o,scale_by:i};if(e<r&&t<n)return a;if(e>r&&t>n){var c=r/e,u=n/t;c<u?(o=c,i="height"):(o=u,i="width")}else e>r?(o=r/e,i="height"):(o=n/t,i="width");return a.width=t*o,a.height=e*o,a.scale=o,a.scale_by=i,a}(e.width,e.height,w.current.width,w.current.height);"none"===r.scale_by&&t.drawImage(e,(w.current.width-r.width)/2,(w.current.height-r.height)/2,r.width,r.height),"width"===r.scale_by&&t.drawImage(e,0,(w.current.height-r.height)/2,r.width,r.height),"height"===r.scale_by&&t.drawImage(e,(w.current.width-r.width)/2,0,r.width,r.height);var o=t.getImageData(0,0,w.current.width,w.current.height),i=l()(o.data,o.width,o.height,{inversionAttempts:"dontInvert"});function a(e,n,r){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.lineWidth=4,t.strokeStyle=r,t.stroke()}i&&(a(i.location.topLeftCorner,i.location.topRightCorner,s.outline.color),a(i.location.topRightCorner,i.location.bottomRightCorner,s.outline.color),a(i.location.bottomRightCorner,i.location.bottomLeftCorner,s.outline.color),a(i.location.bottomLeftCorner,i.location.topLeftCorner,s.outline.color),n(i.data))}}}()}}),(0,r.jsx)("label",{onClick:function(){y.current.click()},children:g(s.buttons.upload.name)})]})]}),(0,r.jsxs)("div",{className:h().qrcode,children:[(0,r.jsx)("canvas",{ref:_,style:{display:d?"block":"none"}}),(0,r.jsx)("canvas",{ref:w,onClick:function(){var t=document.createElement("a");t.download="qrcode",t.href=w.current.toDataURL("image/png"),document.body.appendChild(t),t.click(),t.remove()},style:{display:d?"none":"block"}})]})]}),(0,r.jsx)("div",{className:h().json,children:(0,r.jsx)(a.ZP,{className:"".concat(h()["python-code"]," ").concat(h().code),value:e,height:"300px",theme:"dark",editable:!d,readOnly:!1,extensions:[],onChange:function(t){d||n(t)}})}),(0,r.jsx)("video",{autoPlay:!0,playsInline:!0,ref:v,className:h().video})]})}var w=!0;function _(){return(0,r.jsx)(g,{})}},5401:function(t){t.exports={wqrcode:"styles_wqrcode__Y3CPj",container:"styles_container__YsEBQ",buttons:"styles_buttons__2a9e_","camera-button":"styles_camera-button__qGui5","upload-button":"styles_upload-button__JadLZ","using-camera":"styles_using-camera__XWNcM",qrcode:"styles_qrcode__xdEQM",json:"styles_json__3OR37",video:"styles_video__JsNpP"}}},function(t){t.O(0,[762,148,568,592,774,888,179],(function(){return e=71661,t(t.s=e);var e}));var e=t.O();_N_E=e}]);