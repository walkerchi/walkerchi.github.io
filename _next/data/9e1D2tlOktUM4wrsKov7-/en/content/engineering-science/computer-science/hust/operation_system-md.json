{"pageProps":{"frontmatter":{"title":"[华科] 操作系统实验","description":"华中科技大学 操作系统实验笔记","date":"2021-3-26","image":"https://s2.loli.net/2022/06/18/avkNoZWeO3dyQfK.jpg"},"content":"<h1>操作系统实验</h1><h1>0.环境配置</h1><h2>0.1 操作系统介绍</h2><p><strong>WSL2</strong>(<em>Windows Subsystem for Linux</em>)</p><p>WSL是一个跑在windows指令集上的指令集，没有Linux内核，而WSL2是一个真正的虚拟机。WSL2和任何虚拟机都互斥。</p><p><strong>需要注意的是</strong></p><ul><li>WSL是没有kernel的，如果要仅需进行实验，请将WSL升级为WSL2</li><li>由于后期下载包很大，为了加速可以对apt进行换源</li><li>WSL2是没有图形界面的，可以后续安装轻量级界面xfce4</li></ul><h2>0.2 WSL2启用</h2><ul><li><p>确定windows 版本为2004及以上，可以通过<a href=\"https://download.microsoft.com/download/8/3/c/83c39dca-2d27-4c24-b98b-0a4d6d921c80/Windows10Upgrade9252.exe\">易升</a>进行升级</p></li><li><p>启用WSL功能</p><p>在 CMD(管理员) 中执行</p><pre><code>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart\n</code></pre><ul><li>开启虚拟机特征</li></ul><pre><code>dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart\n</code></pre></li><li><p>下载安装Linux内核</p><ul><li><a href=\"https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi\">x64</a></li><li><a href=\"https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_arm64.msi\">ARM64</a></li></ul></li><li><p>在应用商店安装linux发行版本(如果之前安装过可以不用)</p></li><li><p>WSL 升级到WSL2</p><p>在CMD(管理员)中执行</p><pre><code class=\"language-cmd\">wsl --set-default-version 2\r\nwsl --set-version Ubuntu 2\n</code></pre></li><li><p>检查版本</p><pre><code class=\"language-cmd\">wsl -l -v\r\n\n</code></pre></li></ul><h2>0.3 换源apt</h2><ul><li><p>查看ubuntu 版本 **敲黑板，注意版本，不然下载会出现包损坏的情况 ** 找到版本, 这里的<em>Codename</em>是<em>focal</em></p><pre><code class=\"language-bash\">lsb_release -a\n</code></pre><pre><code>No LSB modules are available.\r\nDistributor ID: Ubuntu\r\nDescription:    Ubuntu 20.04.1 LTS\r\nRelease:        20.04\r\nCodename:       focal\n</code></pre></li><li><p>根据相关ubuntu版本找到国内源 将*/etc/apt/sources.list*中文件替换为国内相应的源（这里是阿里源focal），一定要对应版本，不然会有包依赖损坏</p><pre><code class=\"language-bash\">touch sources.aliyun\r\necho \"\r\ndeb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse\r\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse\r\ndeb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse\r\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse\r\ndeb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse\r\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse\r\ndeb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse\r\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse\r\ndeb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse\r\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse\r\n\">>sources.aliyun\r\nsudo cat sources.aliyun > /etc/apt/sources.list\n</code></pre></li></ul><h2>0.4 安装图形化界面</h2><ul><li><p>下载xfce4</p><pre><code class=\"language-bash\">sudo apt-get install xfce4-terminal\r\nsudo apt-get install xfce4\n</code></pre></li><li><p>安装中文字体</p><pre><code class=\"language-bash\">sudo apt-get install ttf-wqy-zenhei\n</code></pre></li><li><p>配置环境 在windows中使用<span class=\"math math-inline\">ipconfig</span>指令来查看WSL2的IP</p><pre><code class=\"language-sh\">> ipconfig\n</code></pre><p>在WSL2中的<em>~.bashrc​</em>中配置IP</p><pre><code class=\"language-bash\">export DISPLAY=172.18.112.1:0 #这里改成WSL2的IP\n</code></pre><p>更新WSL2</p><pre><code class=\"language-bash\">source ~/.bashrc\n</code></pre></li><li><p>windows XLaunch</p><ul><li>windows<a href=\"https://sourceforge.net/projects/vcxsrv/\">下载安装xcvsrv</a></li><li>windows 打开XLaunch</li></ul></li><li><p>打开图形界面 先运行WSL2中命令，再打开界面</p><pre><code class=\"language-bash\">startxfce4\n</code></pre><p>打开Xlaunch 的时候 Disable access control<strong>一定需要勾选</strong></p></li></ul><h2>0.5 安装GTK2.0</h2><p>因为网上的GTK3.0的教程太少了，实验时间也紧，所以换成了GTK2.0 GTK2.0并QT小太多了，如果仅仅做实验的话建议安装GTK</p><ul><li><p>安装GNU编译链接工具</p><pre><code class=\"language-bash\">sudo apt-get install build-essential\n</code></pre></li><li><p>安装gtk</p><pre><code class=\"language-bash\">sudo apt-get install libgtk-3-dev\n</code></pre></li><li><p>自动查找gtk头文件</p><pre><code class=\"language-bash\">sudo apt-get install pkg-config\n</code></pre></li></ul><h1>1.任务一：多进程和GTK的使用</h1><h2>1.1 实验要求</h2><ul><li><p>誊抄程序</p><p>编一个C程序，其内容为实现文件拷贝的功能。基本要求：使用系统调用open/read/write... 选择：容错、cp</p></li><li><p>GTK实现多窗口应用</p><p>编一个C程序，其内容为分窗口同时显示三个并发进程的运行结果。要求用到Linux下的图形库。 (gtk/Qt) 基本要求：三个独立子进程，各自窗口显示； 选择：三个进程誊抄演示</p></li></ul><h2>1.2 实现原理</h2><ul><li><p>誊抄程序</p><p>进程1从<span class=\"math math-inline\">src\\_file</span>中循环读取字符串存入<span class=\"math math-inline\">s</span>,进程2循环从<span class=\"math math-inline\">s</span>中读取内容存入<span class=\"math math-inline\">t</span>,进程3循环从<span class=\"math math-inline\">t</span>中读取字符串写入<span class=\"math math-inline\">dst\\_file</span>。进程间通过管道进行通信。</p></li></ul><p><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"55\" fill=\"#333\" font-family=\"&#x22;trebuchet ms&#x22;,verdana,arial,sans-serif\" font-size=\"16px\" style=\"max-width:511.078125px\" viewBox=\"0 0 511.078 55\"><defs><path id=\"b\" stroke-dasharray=\"1 0\" d=\"m0 0 10 5-10 5z\"/></defs><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"3.5px\" marker-end=\"url(#a)\" d=\"M80.938 27.5H170.969\"/><defs><marker id=\"a\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"3.5px\" marker-end=\"url(#c)\" d=\"M209.969 27.5H300\"/><defs><marker id=\"c\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"3.5px\" marker-end=\"url(#d)\" d=\"M339 27.5H429.031\"/><defs><marker id=\"d\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g color=\"#333\" transform=\"translate(125.953 27.5) translate(-20.016 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"40.031\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"40.031\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">proc1</span></div></foreignObject></g><g color=\"#333\" transform=\"translate(254.984 27.5) translate(-20.016 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"40.031\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"40.031\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">proc2</span></div></foreignObject></g><g color=\"#333\" transform=\"translate(384.016 27.5) translate(-20.016 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"40.031\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"40.031\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">proc3</span></div></foreignObject></g><g opacity=\"1\" transform=\"translate(44.469 27.5)\"><rect width=\"72.938\" height=\"39\" x=\"-36.469\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"5\" ry=\"5\"/><foreignObject width=\"52.938\" height=\"19\" transform=\"translate(-26.469 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">src_file</div></foreignObject></g><g opacity=\"1\" transform=\"translate(466.055 27.5)\"><rect width=\"74.047\" height=\"39\" x=\"-37.023\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"5\" ry=\"5\"/><foreignObject width=\"54.047\" height=\"19\" transform=\"translate(-27.023 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">dst_file</div></foreignObject></g><g opacity=\"1\" transform=\"translate(190.469 27.5)\"><circle r=\"19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\"/><foreignObject width=\"6.484\" height=\"19\" transform=\"translate(-3.242 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">s</div></foreignObject></g><g opacity=\"1\" transform=\"translate(319.5 27.5)\"><circle r=\"19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\"/><foreignObject width=\"6.344\" height=\"19\" transform=\"translate(-3.172 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">t</div></foreignObject></g></svg></p><ul><li><p>GTK实现多窗口应用</p><p>main文件连续调用三次<span class=\"math math-inline\">execv</span>函数分别执行<span class=\"math math-inline\">fibo(运算斐波那契数列),acc(输出\\#),time(显示当前时间)</span>三个进程</p><p><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"233\" fill=\"#333\" font-family=\"&#x22;trebuchet ms&#x22;,verdana,arial,sans-serif\" font-size=\"16px\" style=\"max-width:224.90625px\" viewBox=\"0 0 224.906 233\"><defs><path id=\"b\" stroke-dasharray=\"1 0\" d=\"m0 0 10 5-10 5z\"/></defs><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#a)\" d=\"m51.52 97 9.516-11.583c9.516-11.584 28.549-34.75 49.413-46.25 20.864-11.5 43.559-11.334 54.906-11.25l11.348.083\"/><defs><marker id=\"a\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#c)\" d=\"M63 116.5h7.603c7.603 0 22.808 0 42.07.083 19.262.084 42.58.25 54.238.334l11.66.083\"/><defs><marker id=\"c\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#d)\" d=\"m51.52 136 9.516 11.583c9.516 11.584 28.549 34.75 49.001 46.417 20.453 11.667 42.325 11.833 53.261 11.917l10.936.083\"/><defs><marker id=\"d\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g color=\"#333\" transform=\"translate(108.617 27.5) translate(-20.617 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"41.234\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"41.234\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">execv</span></div></foreignObject></g><g color=\"#333\" transform=\"translate(108.617 116.5) translate(-20.617 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"41.234\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"41.234\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">execv</span></div></foreignObject></g><g color=\"#333\" transform=\"translate(108.617 205.5) translate(-20.617 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"41.234\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"41.234\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">execv</span></div></foreignObject></g><g opacity=\"1\" transform=\"translate(35.5 116.5)\"><rect width=\"55\" height=\"39\" x=\"-27.5\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"5\" ry=\"5\"/><foreignObject width=\"35\" height=\"19\" transform=\"translate(-17.5 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">main</div></foreignObject></g><g opacity=\"1\" transform=\"translate(190.445 27.5)\"><polygon fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" points=\"-19.5,0 47.984375,0 47.984375,-39 -19.5,-39 0,-19.5\" transform=\"translate(-23.992 19.5)\"/><foreignObject width=\"27.984\" height=\"19\" transform=\"translate(-13.992 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">fibo</div></foreignObject></g><g opacity=\"1\" transform=\"translate(190.445 116.5)\"><polygon fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" points=\"-19.5,0 44.25,0 44.25,-39 -19.5,-39 0,-19.5\" transform=\"translate(-22.125 19.5)\"/><foreignObject width=\"24.25\" height=\"19\" transform=\"translate(-12.125 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">acc</div></foreignObject></g><g opacity=\"1\" transform=\"translate(190.445 205.5)\"><polygon fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" points=\"-19.5,0 52.921875,0 52.921875,-39 -19.5,-39 0,-19.5\" transform=\"translate(-26.46 19.5)\"/><foreignObject width=\"32.922\" height=\"19\" transform=\"translate(-16.46 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">time</div></foreignObject></g></svg></p></li></ul><h2>1.3 效果展示</h2><ul><li><p>誊抄程序</p><p><img src=\"https://s2.loli.net/2022/06/18/vPmGRqreA5nKsxX.png\" alt=\"image-20210326163406102\" width=\"1585\" height=\"141\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABCAIAAAB2XpiaAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFUlEQVQImWN4/f+DuKKVpXUgAwMvACahBB+Y5zPoAAAAAElFTkSuQmCC\"></p></li><li><p>GTK实现多窗口应用</p><p><img src=\"https://s2.loli.net/2022/06/18/1tjHLM8Wk4AvZNS.png\" alt=\"image-20210326163512419\" width=\"1920\" height=\"1080\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMklEQVQImQEnANj/ANjY3fj07gcDAwAABgCtyfHf//9ujrYAAzAAACWkADm+AD21AFzsbNkQnrGnjvkAAAAASUVORK5CYII=\"></p></li></ul><h2>1.4 实验心得</h2><ul><li><p>进程间通信一般可以通过<span class=\"math math-inline\">share\\_memory</span>和<span class=\"math math-inline\">pipe</span>来进行通信，但是在通信的时候，有些变量还是需要使用信号灯来管理</p></li><li><p>GTK3.0的中文资料和博客太少了，网上的GTK博客全是2015年以前的。如果学校希望我们使用GTK的话，希望能提供给我们学习路线，GTK的学习成本太高了</p></li><li><p>WSL2安装图形化界面后，在windows中可以通过xlaunch进行连接显示，但是每次都需要在WSL2的<em>~.bashrc</em>中进行修改，之前试了试网上自动化的方法，但是都没有work。</p></li><li><p>apt换源的时候，一定要注意Ubuntu的版本，不同版本的包之间不兼容，会出现包错误的情况，这个时候请检查版本并重新更新apt源</p></li></ul><h1>2.任务二：新增系统调用</h1><h2>2.1 实验要求</h2><p>掌握系统调用的实现过程，通过编译内核方法，增加一个新的系统调用。另编写一个应用程序，使用新增加的系统调用。 (1) 内核编译、生成，用新内核启动； (2) 新增系统调用实现：文件拷贝或P、V操作。</p><h2>2.2 实验原理</h2><h2>2.3 实验流程</h2><h3>2.3.1 准备</h3><ul><li><p>至少需要30G存储空间。wsl默在c盘，如果空间不够可以考虑 <a href=\"https://cloud.tencent.com/developer/article/1594940\">wsl 迁移</a></p></li><li><p><a href=\"https://www.kernel.org/\">下载内核</a>到<span class=\"math math-inline\">/usr/src/</span></p></li></ul><p>查看内核版本，下载相近版本(前向兼容)</p><pre><code>cat /proc/version\n</code></pre><ul><li>解压</li></ul><pre><code class=\"language-bash\">xz -d linux-5.4.102.tar.xz\r\ntar -xvf /usr/src/linux-5.4.102.tar\n</code></pre><ul><li>下载必要包</li></ul><pre><code class=\"language-bash\">apt-get install libncurses5-dev\r\napt-get install libssl-dev\r\napt-get install libelf-dev\n</code></pre><h3>2.3.2 编写功能代码</h3><ul><li>系统函数文件<span class=\"math math-inline\">/usr/src/linux-5.4.102/kernel/sys.c</span></li></ul><p><strong>注意</strong></p><ul><li>printk输出使用dmesg观察</li><li>是否加<code>__x64_</code>取决于tbl文件中的格式</li></ul><pre><code class=\"language-c\">/*\r\nprintk 是kernel函数，在sys.c中有些函数不能使用，必须使用kernel函数, printk不会直接输出到stdout中，在命令行中输入dmesg可以观察到printk的输出\r\n*/\r\nasmlinkage long __x64_sys_chiTest(void){\r\nprintk(\"This is a test of walker chi!\\n\");\r\nreturn 1;\r\n}\n</code></pre><ul><li>头文件<span class=\"math math-inline\">/usr/src/linux-5.4.102/arch/x86/include/asm/syscalls.h</span></li></ul><pre><code class=\"language-c\">asmlinkage long __x64_sys_chiTest(void);\n</code></pre><ul><li>系统调用表<span class=\"math math-inline\">/usr/src/linux-5.11.2/arch/x86/entry/syscalls/syscall\\_64.tbl</span></li></ul><p>调用号不能与表中的其他调用号重复， <span class=\"math math-inline\">chicall</span>是调用</p><pre><code>437\tcommon\t\tchicall\t\t__x64_sys_chiTest\n</code></pre><ul><li>(可省略)系统调用头文件<span class=\"math math-inline\">/usr/include/asm-generic/unistd.h</span></li></ul><p>调用号要和系统调用表中一致</p><pre><code class=\"language-c\">#define __NR_chiTest 437\r\n__SYSYCALL(__NR_chiTest, __x64_sys_chiTest)\n</code></pre><h3>2.3.3 编译内核</h3><ul><li>(可省略)清理次残存文件(<em>如果不是第一次编译</em>)</li></ul><p>保证在<span class=\"math math-inline\">/usr/src/linux-5.4.102</span>文件夹下</p><pre><code class=\"language-bash\">make mrproper\r\nmake clean\n</code></pre><ul><li>配置内核</li></ul><p>wsl2内核<a href=\"https://github.com/microsoft/WSL2-Linux-Kernel/raw/master/Microsoft/config-wsl\">x64</a>配置和<a href=\"https://github.com/microsoft/WSL2-Linux-Kernel/raw/master/Microsoft/config-wsl-arm64\">arm64</a>配置</p><p>放入<span class=\"math math-inline\">/usr/src/linux-5.4.102/.config</span></p><p>修改<span class=\"math math-inline\">/usr/src/linux-5.4.102/Makefile</span></p><pre><code class=\"language-shell\">EXTRAVERSION = Walktu\n</code></pre><p>修改<span class=\"math math-inline\">/usr/src/linux-5.4.102/.config</span></p><pre><code class=\"language-shell\">CONFIG_LOCALVERSION=\"walktu\"\n</code></pre><ul><li>编译内核</li></ul><p>ccache加速(ssd缓存)</p><pre><code class=\"language-bash\">apt-get install ccache\r\nvim ~/.bashrc\r\nexport USE_CCACHE=1\r\nexport CC=\"ccache gcc\"\r\nexport CXX=\"ccache g++\"\r\nexport PATH=\"/usr/lib/ccache:$PATH\"\r\nsource ~/.bashrc\r\nccache -M 32G\n</code></pre><p><a href=\"https://blog.csdn.net/lvliang2008/article/details/8648981\">tmpfs加速(RAM缓存)</a></p><p><span class=\"math math-inline\">make = \\begin{cases} make~bzImage\\\\make~modules\\end{cases}</span></p><p><span class=\"math math-inline\">jN</span>使用<span class=\"math math-inline\">N</span>核编译</p><pre><code class=\"language-bash\">make -j8\n</code></pre><h3>2.3.4 安装内核</h3><pre><code class=\"language-bash\">make modules_install -j8\r\nmake install -j8\n</code></pre><ul><li>windows 关闭WSL2</li></ul><pre><code class=\"language-bash\">wsl --shutdown\n</code></pre><ul><li>在windows中替换WSL2 kernel</li></ul><p>用*\\wsl$\\usr\\src\\linux-5.4.102\\arch\\x86\\boot\\bzImage<em>文件替换</em>C:\\Windows\\System32\\lxss\\tools\\kernel*文件</p><h3>2.3.5 检查</h3><ul><li>检查内核版本</li></ul><pre><code class=\"language-bash\">uname -r\n</code></pre><ul><li>检查系统调用</li></ul><pre><code class=\"language-c\">#include&#x3C;stdio.h>\r\n#include&#x3C;linux/unistd.h>\r\n#include&#x3C;asm/unistd.h>\r\n\r\nint main(int argc,char **argv){\r\n    int i=syscall(437);\r\n    if (i==1)\r\n      printf(\"succeed!\\n\");\r\n    else\r\n      printf(\"failed!\\n\");\r\n    return 1;\r\n}\n</code></pre><p>在命令行中输入<span class=\"math math-inline\">dmesg</span>,如果出现<span class=\"math math-inline\">This~is~a~test~of~walker~chi!</span>则成功</p><h2>2.4 效果展示</h2><p><img src=\"https://s2.loli.net/2022/06/18/KOirxRBhWZ289Nf.png\" alt=\"image-20210326163743162\" width=\"733\" height=\"50\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABCAIAAAB2XpiaAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFUlEQVQImWN49//9rbcvNDSsGRl4ADedBiQEMxjwAAAAAElFTkSuQmCC\"></p><p><img src=\"https://s2.loli.net/2022/06/18/CotQDiXchvZMruP.png\" alt=\"image-20210326163923920\" width=\"930\" height=\"74\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABCAIAAAB2XpiaAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFUlEQVQImWN48///9LnLC3NrGRhEATWgBjZha2kEAAAAAElFTkSuQmCC\"></p><p><img src=\"https://s2.loli.net/2022/06/18/ZpG8dQ2HFsm3fqR.png\" alt=\"image-20210326164151793\" width=\"951\" height=\"144\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABCAIAAAB2XpiaAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFklEQVQImWN48///ph0Htqw/xMAgDgA8DAdREgD5dQAAAABJRU5ErkJggg==\"></p><h2>2.5 实验心得</h2><ul><li><p>一定要使用WSL2, WSL是没有kernel的, 不是真正的虚拟机, 没有内存, WSL2才是真正的虚拟机</p></li><li><p>编译内核时一定要使用加速方法，否则编译奇慢，加速后可以达到几分钟以内完成编译</p></li><li><p>新增加的系统调用一定使用kernel函数，不要使用用户函数，因为用户函数在这个阶段还没有包装好</p></li></ul><h1>3.任务三：新增设备驱动</h1><h2>3.1 实验要求</h2><p>掌握增加设备驱动程序的方法。通过模块方法，增加一个新的字符设备驱动程序，其功能可以简单,基于内核缓冲区。 基本要求：演示实现字符设备读、写； 选择：键盘缓冲区，不同进程、追加、读取</p><h2>3.2 实验原理</h2><p>Linux系统使用文件来模拟一切，因此设备也可以用文件进行模拟</p><p>对于一个设备驱动，需要实现 <em>__init, __exit, _open, _release, _read, _write, _llseek, _ioctl</em>等方法即可</p><h2>3.3 实验流程</h2><h3>3.3.1 编写设备代码</h3><p>实现模块函数<span class=\"math math-inline\">chi\\_dev.c</span></p><p>编译<span class=\"math math-inline\">chi\\_dev.c</span></p><pre><code>KVERS :=$(shell uname -r)\r\nPWD :=$(shell pwd)\r\nmake -C /lib/modules/$(KVERS)/build M=$(PWD) modules\n</code></pre><h3>3.3.2 安装模块</h3><pre><code>sudo insmod chi_dev.ko\n</code></pre><h3>3.3.3 设置权限</h3><pre><code>sudo chmod 777 /dev/chidriver\n</code></pre><h3>3.3.4 查看信息</h3><p>查看所有安装模块</p><pre><code>lsmod\n</code></pre><p>查看chi_dev信息</p><pre><code>modinfo chi_dev.ko\n</code></pre><h3>3.3.5 验证</h3><p>编写<span class=\"math math-inline\">test.c</span>文件, 对chidriver进行操作, 代码见附录</p><h2>3.4 效果展示</h2><p>安装模块，中间有很多<span class=\"math math-inline\">warning</span>，不过可以忽略</p><p><img src=\"https://s2.loli.net/2022/06/18/EiMPJ8qwLc4VNhz.png\" alt=\"实验三.1\" width=\"939\" height=\"890\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAIAAAAmkwkpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAP0lEQVQImQE0AMv/AC8+QDtDS1VVYwAAFwB+eomXk5rw5eZRSlMA//z/vLq97+Pra2FtAKGgqri2vouCijk4QEP2GQujorHxAAAAAElFTkSuQmCC\"> <img src=\"https://s2.loli.net/2022/06/18/L8kXstx9hUqlgI3.png\" alt=\"实验三.2\" width=\"941\" height=\"948\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAIAAAAmkwkpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAP0lEQVQImQE0AMv/ACcoM0dKVTw7SAAAEwBSVmKJiZHh2N1ISlIA8fH50MvQ//3/f3mBANrR4Lu3wN7V2nBrdS6KGrYW/FZbAAAAAElFTkSuQmCC\"> <img src=\"https://s2.loli.net/2022/06/18/xQiypvlSodO7Bah.png\" alt=\"实验三.3\" width=\"947\" height=\"656\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMElEQVQImWPw8Q5LS848tme/qKAUw9///3s7+x9dv+fk4MYwcfrcmOjkUP9wBgYBAF17EIpGLw0KAAAAAElFTkSuQmCC\"></p><p>编译test文件进行测试 <img src=\"https://s2.loli.net/2022/06/18/R3mxvWO72h9dubB.png\" alt=\"img\" width=\"951\" height=\"422\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAIAAADwyuo0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAI0lEQVQImWN49/9339TZZ47fMDF1Y1i6eUtuQXlaQi4DgzAAxxUMZ9h7JxMAAAAASUVORK5CYII=\"></p><h2>3.5 实验心得</h2><ul><li><p>如果chidriver不能访问，一般是权限不够，因此设置chidirver的权限可以解决该问题</p></li><li><p>在WSL2上与VMware上不同, WSL2中的原来安装模块是空的，因此非常容易辨别是否添加了模块</p></li><li><p>模块的<em>__init</em>方法只会在安装的时候执行一次，而<em>_open</em>方法会在每次打开时都执行，弄清楚每个函数在什么时候执行的才能让测试程序不出bug。</p></li></ul><h1>4.任务四：使用GTK实现系统监控器</h1><h2>4.1 实验要求</h2><p>使用GTK/QT实现系统监控器 了解/proc文件的特点和使用方法； 监控系统中进程运行情况； 用图形界面实现系统资源的监控。</p><h2>4.2 实验原理</h2><p>CPU信息，RAM信息，进程信息等等在linux中都用文件来进行表示，这些文件在/proc文件目录下</p><p>CPU使用率等信息可以在<span class=\"math math-inline\">/proc/cpuinfo</span>下查询得到；RAM使用信息可以在/proc/meminfo下查询得到；进程信息可以<span class=\"math math-inline\">/proc</span>文件夹下所有数字命名的文件夹，数字为进程号，可以用<span class=\"math math-inline\">ps ~aux</span>进行查询；模块信息可以在<span class=\"math math-inline\">/proc/modules</span>下查询</p><p><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"411\" fill=\"#333\" font-family=\"&#x22;trebuchet ms&#x22;,verdana,arial,sans-serif\" font-size=\"16px\" style=\"max-width:257.546875px\" viewBox=\"0 0 257.547 411\"><defs><path id=\"b\" stroke-dasharray=\"1 0\" d=\"m0 0 10 5-10 5z\"/></defs><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#a)\" d=\"m44.043 186 8.164-26.417c8.165-26.416 24.495-79.25 37.635-105.666C102.982 27.5 112.932 27.5 117.908 27.5h4.975\"/><defs><marker id=\"a\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#c)\" d=\"m50.07 186 7.16-11.583c7.16-11.584 21.48-34.75 32.808-46.334 11.327-11.583 19.66-11.583 23.827-11.583h4.166\"/><defs><marker id=\"c\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#d)\" d=\"M68.031 205.5h70.047\"/><defs><marker id=\"d\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#e)\" d=\"m50.07 225 7.16 11.583c7.16 11.584 21.48 34.75 33.111 46.334 11.63 11.583 20.57 11.583 25.04 11.583h4.47\"/><defs><marker id=\"e\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#f)\" d=\"m44.043 225 8.164 26.417c8.165 26.416 24.495 79.25 41.594 105.666 17.1 26.417 34.97 26.417 43.905 26.417h8.935\"/><defs><marker id=\"f\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><foreignObject width=\"0\" height=\"0\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"></span></div></foreignObject><foreignObject width=\"0\" height=\"0\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"></span></div></foreignObject><foreignObject width=\"0\" height=\"0\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"></span></div></foreignObject><foreignObject width=\"0\" height=\"0\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"></span></div></foreignObject><foreignObject width=\"0\" height=\"0\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"></span></div></foreignObject><g opacity=\"1\" transform=\"translate(38.016 205.5)\"><rect width=\"60.031\" height=\"39\" x=\"-30.016\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"5\" ry=\"5\"/><foreignObject width=\"40.031\" height=\"19\" transform=\"translate(-20.016 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">/proc</div></foreignObject></g><g opacity=\"1\" transform=\"translate(183.79 27.5)\"><rect width=\"121.813\" height=\"39\" x=\"-60.906\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"5\" ry=\"5\"/><foreignObject width=\"101.813\" height=\"19\" transform=\"translate(-50.906 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">/proc/cpuinfo</div></foreignObject></g><g opacity=\"1\" transform=\"translate(183.79 116.5)\"><rect width=\"131.516\" height=\"39\" x=\"-65.758\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"5\" ry=\"5\"/><foreignObject width=\"111.516\" height=\"19\" transform=\"translate(-55.758 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">/proc/meminfo</div></foreignObject></g><g opacity=\"1\" transform=\"translate(183.79 294.5)\"><rect width=\"127.875\" height=\"39\" x=\"-63.938\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"5\" ry=\"5\"/><foreignObject width=\"107.875\" height=\"19\" transform=\"translate(-53.938 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">/proc/modules</div></foreignObject></g><g opacity=\"1\" transform=\"translate(183.79 205.5)\"><rect width=\"91.422\" height=\"39\" x=\"-45.711\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"5\" ry=\"5\"/><foreignObject width=\"71.422\" height=\"19\" transform=\"translate(-35.71 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">/proc/\\d+</div></foreignObject></g><g opacity=\"1\" transform=\"translate(183.79 383.5)\"><rect width=\"74.297\" height=\"39\" x=\"-37.148\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"5\" ry=\"5\"/><foreignObject width=\"54.297\" height=\"19\" transform=\"translate(-27.148 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">/proc/*</div></foreignObject></g></svg></p><h2>4.3 效果展示</h2><p><img src=\"https://s2.loli.net/2022/06/18/WebFhgqcCTMDztI.png\" alt=\"image-20210326172202046\" width=\"1920\" height=\"1080\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMklEQVQImQEnANj/AG6Rqqq5w3eftwB/uwCuu8b///9XX2kEAAAAMm3DVIXNAEimAEXFh6ISJoF9/FcAAAAASUVORK5CYII=\"> <img src=\"https://s2.loli.net/2022/06/18/XTiKIegj2MUdYas.png\" alt=\"image-20210326172221505\" width=\"1920\" height=\"1080\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMklEQVQImQEnANj/AHieta29x7zl/1my8QCsvMX///mBipMEAAAAbp32msT/O2XIR2Tr1YgWuxHNWWEAAAAASUVORK5CYII=\"> <img src=\"https://s2.loli.net/2022/06/18/AvcJ2GjXnbigKQr.png\" alt=\"image-20210326172234777\" width=\"1920\" height=\"1080\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMklEQVQImQEnANj/AI2yysfY4tv//3TI/wCBlJ28v7WWnqkEAAAAX4rld6HuTnTXW3L83A0WmLOOzw0AAAAASUVORK5CYII=\"> <img src=\"https://s2.loli.net/2022/06/18/lZByLD8Q6E4Now7.png\" alt=\"image-20210326172246135\" width=\"1920\" height=\"1080\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMklEQVQImQEnANj/AHGTra27x3efuAB/ugCwwNH///9ZYGkEAAAANW7CVofPAEimAEbFjDQSVh4+V2YAAAAASUVORK5CYII=\"> 因为在实验三中安装了自己编写的模块，会因此出现新加入的模块 <img src=\"https://s2.loli.net/2022/06/18/dT2lGAJDCkMnLFp.png\" alt=\"image-20210326172254469\" width=\"1920\" height=\"1080\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMklEQVQImQEnANj/AHKVrq++yIStxReIxACptsL///1eZ3EEAAAAOXDGW4nSBk2tCkvMlp8S4O2eGSgAAAAASUVORK5CYII=\"></p><p>观察<span class=\"math math-inline\">/proc</span>文件夹 <img src=\"https://s2.loli.net/2022/06/18/uka6hsgSw3YtTbU.png\" alt=\"img\" width=\"946\" height=\"361\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABCAIAAAB2XpiaAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFklEQVQImWM4dfHp9Glz///9z8jAAwA4sgdT1OJiQgAAAABJRU5ErkJggg==\"> <img src=\"https://s2.loli.net/2022/06/18/sy9AxOStcVTpnNf.png\" alt=\"img\" width=\"926\" height=\"489\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAIAAADwyuo0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAI0lEQVQImWMwtHGwc3BbOmcpA4Mgw/9//2vL67av3ejr7gsAe/0Kzb/ooFYAAAAASUVORK5CYII=\"> <img src=\"https://s2.loli.net/2022/06/18/oVpwHhKi6UGn8De.png\" alt=\"img\" width=\"935\" height=\"652\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMElEQVQImWPwDo7U0DcXl1JjYBBlyMopK8wrWzFnkYmxFcP////Xr910cNvuisJyAOj6D7c5rRR0AAAAAElFTkSuQmCC\"></p><h2>4.4 实验心得</h2><ul><li><p>首先要弄清楚<span class=\"math math-inline\">/proc</span>文件夹下每个文件的信息，对这些信息进行字符串处理比较简单。对于窗口程序，从零开始撸会感觉到浪费生命，可以直接用现有的进行定制修改。</p></li><li><p>与VMware不同, WSL2的modules文件夹下很干净，只有之前实验三安装的模块</p></li></ul><h1>5.任务五：小型文件系统</h1><h2>5.1 实验要求</h2><p>设计并实现一个模拟的文件系统 (1)基于一大文件(10M或100M)，模拟磁盘； (2)格式化，建立文件系统管理数据结构； (2)基本操作，实现文件、目录相关操作。 选择：实现图形界面操作。</p><h2>5.2 实验原理</h2><p>整个文件系统可以看做是对一个超大文件的分块管理，每一个块<span class=\"math math-inline\">Block</span>可以存放<span class=\"math math-inline\">SuperBlock</span>或者<span class=\"math math-inline\">DataBlock</span></p><ul><li><p><span class=\"math math-inline\">SuperBlock</span></p><p><span class=\"math math-inline\">SuperBlock</span>有且仅有一个，用于控制全局的<span class=\"math math-inline\">inode</span>，<span class=\"math math-inline\">SuperBlock</span>存储在文件的第一个<span class=\"math math-inline\">Block</span>中。</p><ul><li><span class=\"math math-inline\">inode\\_map</span>存放inode是否被分配的bitmap,已分配为1,未分配为0, 使用循环进行遍历查询</li><li><span class=\"math math-inline\">block\\_map</span>存放<span class=\"math math-inline\">DataBlock</span>是否被分配的bitmap, 已分配为1, 未分配为0, 使用循环进行遍历</li></ul></li><li><p><span class=\"math math-inline\">Inode</span></p><p><span class=\"math math-inline\">Inode</span>是每个文件/文件夹的信息头，包括了对文件使用<span class=\"math math-inline\">Block</span>的描述以及对于文件的权限</p><ul><li><span class=\"math math-inline\">block\\_used</span>存放inode使用到的<span class=\"math math-inline\">DataBlock</span>的编号</li><li><span class=\"math math-inline\">mode</span>辨识<span class=\"math math-inline\">inode</span>是文件还是文件夹，以及用户权限</li><li><span class=\"math math-inline\">size</span>实际使用字节大小, 如果是文件类型，初始化为0，如果是文件夹类型初始化为两个链接大小, 因为每个文件夹默认包含'.'和'..'</li></ul></li><li><p><span class=\"math math-inline\">DataBlock</span></p><p>用于存储数据二进制数据</p></li></ul><p><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"708\" fill=\"#333\" font-family=\"&#x22;trebuchet ms&#x22;,verdana,arial,sans-serif\" font-size=\"16px\" style=\"max-width:249.890625px\" viewBox=\"0 0 249.891 708\"><defs><path id=\"a\" d=\"m18 7-9 6-8-6 8-6Z\"/></defs><defs><marker fill=\"#ececff\" stroke=\"#333\" stroke-width=\"1\" markerHeight=\"240\" markerWidth=\"190\" orient=\"auto\" refX=\"0\" refY=\"7\"><use xlink:href=\"#a\"/></marker></defs><defs><marker fill=\"#ececff\" stroke=\"#333\" stroke-width=\"1\" markerHeight=\"28\" markerWidth=\"20\" orient=\"auto\" refX=\"19\" refY=\"7\"><use xlink:href=\"#a\"/></marker></defs><defs><marker fill=\"#333\" stroke=\"#333\" stroke-width=\"1\" markerHeight=\"240\" markerWidth=\"190\" orient=\"auto\" refX=\"0\" refY=\"7\"><path d=\"m1 7 17 6V1Z\"/></marker></defs><defs><marker id=\"b\" fill=\"#333\" stroke=\"#333\" stroke-width=\"1\" markerHeight=\"28\" markerWidth=\"20\" orient=\"auto\" refX=\"19\" refY=\"7\"><path d=\"M1 1v12l17-6Z\"/></marker></defs><defs><marker fill=\"#333\" stroke=\"#333\" stroke-width=\"1\" markerHeight=\"240\" markerWidth=\"190\" orient=\"auto\" refX=\"0\" refY=\"7\"><use xlink:href=\"#a\"/></marker></defs><defs><marker id=\"c\" fill=\"#333\" stroke=\"#333\" stroke-width=\"1\" markerHeight=\"28\" markerWidth=\"20\" orient=\"auto\" refX=\"19\" refY=\"7\"><use xlink:href=\"#a\"/></marker></defs><defs><marker fill=\"#333\" stroke=\"#333\" stroke-width=\"1\" markerHeight=\"240\" markerWidth=\"190\" orient=\"auto\" refX=\"0\" refY=\"7\"><path d=\"m5 7 4 6-8-6 8-6Z\"/></marker></defs><defs><marker id=\"d\" fill=\"#333\" stroke=\"#333\" stroke-width=\"1\" markerHeight=\"28\" markerWidth=\"20\" orient=\"auto\" refX=\"19\" refY=\"7\"><path d=\"m18 7-9 6 5-6-5-6Z\"/></marker></defs><path fill=\"none\" stroke=\"#333\" stroke-dasharray=\"0\" stroke-width=\"1\" marker-end=\"url(#b)\" d=\"m131.863 66 5.163 5.75c5.164 5.75 15.49 17.25 20.654 28.75s5.164 23 5.164 28.75V135\"/><path fill=\"none\" stroke=\"#333\" stroke-dasharray=\"0\" stroke-width=\"1\" marker-end=\"url(#b)\" d=\"m79.778 66-5.163 5.75C69.45 77.5 59.124 89 53.96 113c-5.163 24-5.163 60.5-5.163 97v253.5c0 48 0 96 5.163 125.75 5.164 29.75 15.491 41.25 20.655 47l5.163 5.75\"/><path fill=\"none\" stroke=\"#333\" stroke-dasharray=\"0\" stroke-width=\"1\" marker-end=\"url(#c)\" d=\"M162.844 285v69\"/><path fill=\"none\" stroke=\"#333\" stroke-dasharray=\"0\" stroke-width=\"1\" marker-end=\"url(#d)\" d=\"M162.844 573v5.75c0 5.75 0 17.25-5.164 28.75-5.163 11.5-15.49 23-20.654 28.75l-5.163 5.75\"/><foreignObject width=\"81.594\" height=\"19\" transform=\"translate(162.844 100.5) translate(-40.797 -9.5)\" color=\"#131300\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\" style=\"background:#ececff\"><span color=\"#131300\" style=\"background:#ececff\">Inheritance</span></span></div></foreignObject><foreignObject width=\"81.594\" height=\"19\" transform=\"translate(48.797 319.5) translate(-40.797 -9.5)\" color=\"#131300\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\" style=\"background:#ececff\"><span color=\"#131300\" style=\"background:#ececff\">Inheritance</span></span></div></foreignObject><foreignObject width=\"88.219\" height=\"19\" transform=\"translate(162.844 319.5) translate(-44.11 -9.5)\" color=\"#131300\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\" style=\"background:#ececff\"><span color=\"#131300\" style=\"background:#ececff\">Composition</span></span></div></foreignObject><foreignObject width=\"80.109\" height=\"19\" transform=\"translate(162.844 607.5) translate(-40.055 -9.5)\" color=\"#131300\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\" style=\"background:#ececff\"><span color=\"#131300\" style=\"background:#ececff\">Association</span></span></div></foreignObject><g transform=\"translate(105.82 37)\"><rect width=\"55.25\" height=\"58\" x=\"-27.625\" y=\"-29\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\"/><line x1=\"-27.625\" x2=\"27.625\" y1=\"2\" y2=\"2\" stroke=\"1\"/><line x1=\"-27.625\" x2=\"27.625\" y1=\"18\" y2=\"18\" stroke=\"1\"/><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\"></span></div></foreignObject><foreignObject width=\"40.25\" height=\"19\" font-weight=\"bolder\" transform=\"translate(-20.125 -21.5)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">Block</span></div></foreignObject></g><g transform=\"translate(162.844 210)\"><rect width=\"156.141\" height=\"150\" x=\"-78.07\" y=\"-75\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\"/><line x1=\"-78.07\" x2=\"78.07\" y1=\"-44\" y2=\"-44\" stroke=\"1\"/><line x1=\"-78.07\" x2=\"78.07\" y1=\"64\" y2=\"64\" stroke=\"1\"/><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\"></span></div></foreignObject><foreignObject width=\"83.234\" height=\"19\" font-weight=\"bolder\" transform=\"translate(-41.617 -67.5)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">SuperBlock</span></div></foreignObject><foreignObject width=\"114.75\" height=\"19\" transform=\"translate(-70.57 -32.5)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">int[] inode_map</span></div></foreignObject><foreignObject width=\"113.422\" height=\"19\" transform=\"translate(-70.57 -9.5)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">int[] block_map</span></div></foreignObject><foreignObject width=\"141.141\" height=\"19\" transform=\"translate(-70.57 13.5)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">int inode_free_num</span></div></foreignObject><foreignObject width=\"139.813\" height=\"19\" transform=\"translate(-70.57 36.5)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">int block_free_num</span></div></foreignObject></g><g transform=\"translate(105.82 671)\"><rect width=\"88.922\" height=\"58\" x=\"-44.461\" y=\"-29\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\"/><line x1=\"-44.461\" x2=\"44.461\" y1=\"2\" y2=\"2\" stroke=\"1\"/><line x1=\"-44.461\" x2=\"44.461\" y1=\"18\" y2=\"18\" stroke=\"1\"/><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\"></span></div></foreignObject><foreignObject width=\"73.922\" height=\"19\" font-weight=\"bolder\" transform=\"translate(-36.96 -21.5)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">DataBlock</span></div></foreignObject></g><g transform=\"translate(162.844 463.5)\"><rect width=\"158.094\" height=\"219\" x=\"-79.047\" y=\"-109.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\"/><line x1=\"-79.047\" x2=\"79.047\" y1=\"-78.5\" y2=\"-78.5\" stroke=\"1\"/><line x1=\"-79.047\" x2=\"79.047\" y1=\"98.5\" y2=\"98.5\" stroke=\"1\"/><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\"></span></div></foreignObject><foreignObject width=\"41.438\" height=\"19\" font-weight=\"bolder\" transform=\"translate(-20.719 -102)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">Inode</span></div></foreignObject><foreignObject width=\"115.688\" height=\"19\" transform=\"translate(-71.547 -67)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">int[] block_used</span></div></foreignObject><foreignObject width=\"143.094\" height=\"19\" transform=\"translate(-71.547 -44)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">int block_used_num</span></div></foreignObject><foreignObject width=\"51.828\" height=\"19\" transform=\"translate(-71.547 -21)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">int size</span></div></foreignObject><foreignObject width=\"63.984\" height=\"19\" transform=\"translate(-71.547 2)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">int mode</span></div></foreignObject><foreignObject width=\"76.5\" height=\"19\" transform=\"translate(-71.547 25)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">int user_id</span></div></foreignObject><foreignObject width=\"140.125\" height=\"19\" transform=\"translate(-71.547 48)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">time_t create_time</span></div></foreignObject><foreignObject width=\"142.922\" height=\"19\" transform=\"translate(-71.547 71)\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span color=\"#131300\">time_t modify_time</span></div></foreignObject></g></svg></p><p><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"565.25\" fill=\"#333\" font-family=\"&#x22;trebuchet ms&#x22;,verdana,arial,sans-serif\" font-size=\"16px\" style=\"max-width:735.75px\" viewBox=\"0 0 735.75 565.25\"><defs><path id=\"b\" stroke-dasharray=\"1 0\" d=\"m0 0 10 5-10 5z\"/><path id=\"i\" d=\"M0 0z\"/></defs><g opacity=\"1\" transform=\"translate(494.07 456.875)\"><rect width=\"117.922\" height=\"200.75\" x=\"-58.961\" y=\"-100.375\" fill=\"#f90\" stroke=\"#aa3\" stroke-width=\"1px\"/><foreignObject width=\"39.531\" height=\"19\" transform=\"translate(0 -86.375) translate(-19.766 -9.5)\" color=\"#333\" font-family=\"&#x22;trebuchet ms&#x22;,verdana,arial,sans-serif\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">inode</div></foreignObject></g><g opacity=\"1\" transform=\"translate(467.945 172.25)\"><rect width=\"519.609\" height=\"328.5\" x=\"-259.805\" y=\"-164.25\" fill=\"#ccf\" stroke=\"#aa3\" stroke-width=\"1px\"/><foreignObject width=\"38.359\" height=\"19\" transform=\"translate(0 -150.25) translate(-19.18 -9.5)\" color=\"#333\" font-family=\"&#x22;trebuchet ms&#x22;,verdana,arial,sans-serif\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">Block</div></foreignObject></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#a)\" d=\"m74.034 183.75 13.741 15.208c13.742 15.209 41.226 45.625 63.577 60.834C173.703 275 190.922 275 203.698 275H233.14\"/><defs><marker id=\"a\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#c)\" d=\"m74.317 144.75 13.694-14.917c13.695-14.916 41.084-44.75 63.388-59.666 22.304-14.917 39.523-14.917 60.52-14.917h335.452c13.994 0 22.327 0 30.66.557 8.334.556 16.667 1.67 20.834 2.226l4.166.557\"/><defs><marker id=\"c\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#d)\" d=\"m100.265 144.75 9.37-4.167c9.37-4.166 28.11-12.5 46.089-16.666 17.98-4.167 35.198-4.167 56.195-4.167h335.452c13.994 0 22.327 0 31.918 2.5 9.591 2.5 20.44 7.5 25.865 10l5.425 2.5\"/><defs><marker id=\"d\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-width=\"2px\" marker-end=\"url(#e)\" d=\"m100.265 183.75 9.37 4.167c9.37 4.166 28.11 12.5 46.089 16.666 17.98 4.167 35.198 4.167 56.195 4.167h335.452c13.994 0 22.327 0 31.918 2.5 9.591 2.5 20.44 7.5 25.865 10l5.425 2.5\"/><defs><marker id=\"e\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-dasharray=\"3\" stroke-width=\"2px\" marker-end=\"url(#f)\" d=\"m331.797 265.475 8.61-1.663c8.609-1.662 25.827-4.987 43.046-6.65 17.219-1.662 34.438-1.662 51.663 21.463 17.225 23.125 34.457 69.375 43.073 92.5l8.616 23.125\"/><defs><marker id=\"f\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-dasharray=\"3\" stroke-width=\"2px\" marker-end=\"url(#g)\" d=\"m331.797 284.525 8.61 1.663c8.609 1.662 25.827 4.987 43.046 6.65 17.219 1.662 34.438 1.662 51.954 33.12 17.516 31.459 35.329 94.375 44.236 125.834l8.906 31.458\"/><defs><marker id=\"g\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#b\" stroke-dasharray=\"1 0\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-dasharray=\"3\" stroke-width=\"2px\" marker-end=\"url(#h)\" d=\"m528.031 407.99 4.167-.707c4.167-.706 12.5-2.12 20.833-53.493 8.334-51.373 16.667-152.707 26.258-205.873 9.591-53.167 20.44-58.167 25.865-60.667l5.425-2.5\"/><defs><marker id=\"h\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#i\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-dasharray=\"3\" stroke-width=\"2px\" marker-end=\"url(#j)\" d=\"m527.396 433.25 4.273 2.5c4.272 2.5 12.817 7.5 21.256-33.25 8.44-40.75 16.773-127.25 26.364-173 9.591-45.75 20.44-50.75 25.865-53.25l5.425-2.5\"/><defs><marker id=\"j\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#i\"/></marker></defs></g><g opacity=\"1\"><path fill=\"none\" stroke=\"#333\" stroke-dasharray=\"3\" stroke-width=\"2px\" marker-end=\"url(#k)\" d=\"M528.031 502.75h4.167c4.167 0 12.5 0 20.833-34.667 8.334-34.666 16.667-104 28.586-144 11.92-40 27.424-50.666 35.176-56l7.753-5.333\"/><defs><marker id=\"k\" markerHeight=\"6\" markerUnits=\"strokeWidth\" markerWidth=\"8\" orient=\"auto\" refX=\"9\" refY=\"5\" viewBox=\"0 0 10 10\"><use xlink:href=\"#i\"/></marker></defs></g><g color=\"#333\" transform=\"translate(156.484 275) translate(-26.656 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"53.313\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"53.313\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">contain</span></div></foreignObject></g><g color=\"#333\" transform=\"translate(383.453 55.25) translate(-26.656 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"53.313\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"53.313\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">contain</span></div></foreignObject></g><g color=\"#333\" transform=\"translate(383.453 119.75) translate(-26.656 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"53.313\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"53.313\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">contain</span></div></foreignObject></g><g color=\"#333\" transform=\"translate(383.453 208.75) translate(-26.656 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"53.313\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"53.313\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">contain</span></div></foreignObject></g><g color=\"#333\" transform=\"translate(383.453 255.5) translate(-25.563 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"51.125\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"51.125\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">control</span></div></foreignObject></g><g color=\"#333\" transform=\"translate(383.453 294.5) translate(-25.563 -9.5)\" style=\"background-color:#e8e8e8;text-align:center\"><rect width=\"51.125\" height=\"19\" fill=\"#e8e8e8\" opacity=\".5\" rx=\"0\" ry=\"0\" style=\"background-color:#e8e8e8\"/><foreignObject width=\"51.125\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\">control</span></div></foreignObject></g><foreignObject width=\"0\" height=\"0\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"></span></div></foreignObject><foreignObject width=\"0\" height=\"0\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"></span></div></foreignObject><foreignObject width=\"0\" height=\"0\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\"><span fill=\"#333\" color=\"#333\" style=\"background-color:#e8e8e8;text-align:center\"></span></div></foreignObject><g opacity=\"1\" transform=\"translate(494.07 413.75)\"><rect width=\"67.922\" height=\"39\" x=\"-33.961\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"0\" ry=\"0\"/><foreignObject width=\"47.922\" height=\"19\" transform=\"translate(-23.96 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">inode0</div></foreignObject></g><g opacity=\"1\" transform=\"translate(494.07 502.75)\"><rect width=\"67.922\" height=\"39\" x=\"-33.961\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"0\" ry=\"0\"/><foreignObject width=\"47.922\" height=\"19\" transform=\"translate(-23.96 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">inode1</div></foreignObject></g><g opacity=\"1\" transform=\"translate(282.469 275)\"><rect width=\"98.656\" height=\"39\" x=\"-49.328\" y=\"-19.5\" fill=\"#f9f\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"0\" ry=\"0\"/><foreignObject width=\"78.656\" height=\"19\" transform=\"translate(-39.328 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">SuperBlock</div></foreignObject></g><g opacity=\"1\" transform=\"translate(652.89 65.25)\"><rect width=\"99.719\" height=\"39\" x=\"-49.859\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"0\" ry=\"0\"/><foreignObject width=\"79.719\" height=\"19\" transform=\"translate(-39.86 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">DataBlock0</div></foreignObject></g><g opacity=\"1\" transform=\"translate(652.89 154.25)\"><rect width=\"99.719\" height=\"39\" x=\"-49.859\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"0\" ry=\"0\"/><foreignObject width=\"79.719\" height=\"19\" transform=\"translate(-39.86 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">DataBlock1</div></foreignObject></g><g opacity=\"1\" transform=\"translate(652.89 243.25)\"><rect width=\"99.719\" height=\"39\" x=\"-49.859\" y=\"-19.5\" fill=\"#ececff\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"0\" ry=\"0\"/><foreignObject width=\"79.719\" height=\"19\" transform=\"translate(-39.86 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">DataBlock2</div></foreignObject></g><g opacity=\"1\" transform=\"translate(56.414 164.25)\"><rect width=\"96.828\" height=\"39\" x=\"-48.414\" y=\"-19.5\" fill=\"#ccc\" stroke=\"#9370db\" stroke-width=\"1px\" rx=\"0\" ry=\"0\"/><foreignObject width=\"76.828\" height=\"19\" transform=\"translate(-38.414 -9.5)\" color=\"#333\" style=\"text-align:center\"><div xmlns=\"http://www.w3.org/1999/xhtml\" display=\"inline-block\" style=\"white-space:nowrap\">FileSystem</div></foreignObject></g></svg></p><h2>5.3 效果展示</h2><p>在<span class=\"math math-inline\">/home/hi</span>文件中写入<span class=\"math math-inline\">welcom~to~walker\\_fs</span> <img src=\"https://s2.loli.net/2022/06/18/Yi3cnfNe6FoHv1b.png\" alt=\"img\" width=\"929\" height=\"175\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABCAIAAAB2XpiaAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFUlEQVQImWP4/v9/VVVrdEgcA4MgADGYBY0ZylhNAAAAAElFTkSuQmCC\"> <img src=\"https://s2.loli.net/2022/06/18/5xlFtjLJWz6GraD.png\" alt=\"img\" width=\"919\" height=\"827\" type=\"png\" blurdataurl=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMklEQVQImQEnANj/ABkVHDpGQLCprQAADQD56ezA1L7//f5gV18A//f4u87A2tLaU1JcX48VDKZ+WuAAAAAASUVORK5CYII=\"></p><h2>5.4 实验心得</h2><ul><li>Linux文件系统确实非常复杂，在有限的时间内只能实现简单的阉割版本，基本的空闲块管理也是通过遍历来获取的，但是这样的效率很低。</li><li>除了基本的<span class=\"math math-inline\">Block</span>管理，还有一些交互命令比较难实现，例如上下键切换之类的，交互的便捷才是Linux文件系统的精髓</li></ul>","renderType":"md","imageProps":{"src":"https://s2.loli.net/2022/06/18/avkNoZWeO3dyQfK.jpg","width":4055,"height":2486,"type":"jpg","blurDataURL":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAACAAQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAdEAACAgIDAQAAAAAAAAAAAAABAwACBQYEESEH/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgT/xAAXEQADAQAAAAAAAAAAAAAAAAAAATEC/9oADAMBAAIRAxEAPwCn9R1vBq2pil4bG0UtYrSleKsCo7t4B14IiJfmAdP/2Q=="},"language":"en"},"__N_SSG":true}