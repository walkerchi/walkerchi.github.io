{
    "componentChunkName": "component---src-templates-blog-template-blog-template-jsx",
    "path": "/blog/Engineering/Computer/DataBase/hust_database",
    "result": {"data":{"markdownRemark":{"rawMarkdownBody":"\r\n\r\n\r\n# 数据库\r\n\r\n## 概论\r\n\r\n### 特点\r\n\r\n结构化、共享度高，冗余度低、易扩展、数据独立性\r\n\r\n### ER图\r\n\r\n- M:N关系需要一张表\r\n- N:1关系不需要表 \r\n\r\n### 数据模型\r\n\r\n- 层次模型\r\n\r\n  - 双亲是唯一的\r\n  - 只能处理一对多联系\r\n\r\n- 网状模型\r\n\r\n  - 允许没有双亲\r\n  - 可以有多个双相亲\r\n  - 只能处理一对多联系\r\n\r\n- 关系模型（主流）\r\n\r\n### 两级映像 三级模式\r\n\r\n```mermaid\r\ngraph LR\r\nA(内模式)\r\nB(模式)\r\nC(外模式View)\r\nA---B\r\nB---C\r\n\r\n```\r\n\r\n\r\n\r\n## 关系数据库\r\n\r\n$关系数据库操作语言\\begin{cases}关系代数语言\\\\关系演算语言\\\\结构化查询语言SQL\\end{cases}$\r\n\r\n$关系：笛卡尔积中有意义的子集$\r\n\r\n$元素：关系中每个元素（行）$\r\n\r\n$属性：列名$\r\n\r\n$候选码：最小能唯一表示一个元组的一组属性$\r\n\r\n$全码：候选码是所有的属性$\r\n\r\n$主码：候选码之一$\r\n\r\n$主属性：候选码的属性$\r\n\r\n$非码属性：任何候选码都不包含的属性$\r\n\r\n$外码：在R中的属性组，在S中是主码$\r\n\r\n### 关系完整性\r\n\r\n- 实体完整性\r\n\r\n  主属性不能为空\r\n\r\n- 参照完整性\r\n\r\n  外码必须为空或S的主码值\r\n\r\n- 用户定义完整性\r\n\r\n### 关系代数\r\n\r\n自然连接：删除重复列 \r\n\r\n- $R(X,Y)\\div S(Y,Z)$\r\n\r\n  $R\\div S = \\{t[X]|t\\in R \\and Y_{t[X]} \\supseteq \\Pi_Y (S)\\}$\r\n\r\n  $R\\div S = \\Pi_X(R) - \\Pi_X(\\Pi_X(R)\\times \\Pi_Y(S) - R)$\r\n  \r\n  ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200824204535830.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2pvZXlfcm8=,size_16,color_FFFFFF,t_70#pic_center)\r\n\r\n## SQL\r\n\r\n### 查询\r\n\r\n- 列出至少有三门课程成绩在90分以上的学生学号和平均成绩\r\n\r\n  ```sql\r\n  select sno,avg(grade) as avg_grade\r\n  from sc sc1\r\n  group by sno\r\n  having (select count(*)\r\n          from sc\r\n          where sno=sc1.sno and grade>=90\r\n         )>=3\r\n  ```\r\n\r\n- exist 与 in 转换 \r\n\r\n  ```sql\r\n  select ... from T1 \r\n  where C1 in (\r\n  \tselect C2 from T2 \r\n  \twhere ...\r\n  )\r\n  select ... from T1\r\n  where exists (\r\n  \tselect * from T1 \r\n       where ... and C2=T1.C1\r\n  )\r\n  ```\r\n\r\n- 查询选修了全部课程的学生的姓名\r\n\r\n  ```sql\r\n  select sname \r\n  from student\r\n  where not exists(\r\n  \tselect * from course\r\n      where not exists(\r\n          \tselect * from sc\r\n              where sno=student.sno and cno = cources.cno\r\n          )\r\n  )\r\n  \r\n  select sname\r\n  from student\r\n  where not exists(\r\n  \tselect * from course\r\n      where cno not in (\r\n      \tselect cno from sc \r\n          where sno = student.sno\r\n      )\r\n  )\r\n  ```\r\n\r\n  \r\n\r\n## 关系数据理论\r\n\r\n### 函数依赖\r\n\r\n$  若s[X]=t[X]则有s[Y]=t[Y]称X函数确定Y（Y函数依赖X，X\\rightarrow Y）$\r\n\r\n$X\\rightarrow Y, Y\\nsubseteq X,则X\\rightarrow Y是非平凡的函数依赖$\r\n\r\n$X\\rightarrow Y,且任意  X'\\in X \\Rightarrow X'\\nrightarrow Y，则Y完全依赖于X$\r\n\r\n$主码候选码统称为码$\r\n\r\n$Armstrong公理系统\\begin{cases}自反律:Y\\subseteq X\\Rightarrow X\\rightarrow Y\\\\赠广律:X\\rightarrow Y\\Rightarrow XZ\\rightarrow YZ\\\\传递律:X\\rightarrow Y,Y\\rightarrow Z\\Rightarrow X\\rightarrow Z\\end{cases}$\r\n\r\n$X\\rightarrow  Y \\Leftrightarrow X_F^+\\supseteq Y$\r\n\r\n候选码的属性一定不会在右侧出现\r\n\r\n- 计算最小依赖集\r\n  1. 右部单属性化\r\n  2. 去掉多余函数依赖\r\n  3. 去掉左部多余属性\r\n- 正则覆盖\r\n  1. 合并左侧相同的函数依赖\r\n  2. 去掉每个函数中的无关属性\r\n- 求候选码\r\n  1. 找到不在右边出现的属性$N$，并计算闭包，如果闭包为U则终止\r\n  2. 找到既在左部又在右部的属性集，将LR的子集并入$N$测试是否构成码\r\n\r\n### 范式\r\n\r\n- 1NF\r\n\r\n  属性不可分\r\n\r\n  数据冗余、更新异常、插入异常、删除异常\r\n\r\n- 2NF\r\n\r\n  非主属性完全依赖于码\r\n\r\n  数据冗余、更新异常、插入异常、删除异常\r\n\r\n- 3NF\r\n\r\n  不允许：\r\n  $$\r\n  X\\rightarrow Y \\rightarrow Z\\\\\r\n  X:码\\quad Y:不含码\\quad Z:非主属性，且Z\\nsubseteq Y\r\n  $$\r\n  \r\n\r\n  没有非主属性对码的传递依赖\r\n\r\n  要么左侧是超码要么右侧是主属性\r\n\r\n  没有非主属性一定是3NF\r\n\r\n  数据冗余、更新异常、插入异常、删除异常\r\n  $$\r\n  若R\\in 3NF 则 R\\in 2NF\r\n  \\\\\r\n  证：\\\\\r\n  假设R\\notin 2NF, 但R\\in 3NF\\\\\r\n  \\because R\\notin 2NF\\\\\r\n  \\therefore \\exist Y\\subset X, Y\\rightarrow Z\\Rightarrow X\\rightarrow Y\\rightarrow Z\\\\\r\n  R\\notin3NF矛盾\r\n  $$\r\n  \r\n- BCNF\r\n\r\n  非平凡函数依赖左侧包含候选码 \r\n  $$\r\n  如果R\\in BCNF 则 R\\in 3NF\r\n  \\\\\r\n  证:\r\n  \\\\\r\n  设R\\in BCNF，但R\\notin 3NF\r\n  \\\\\r\n  则必存在码X，属性组Y，非主属性组Z：\r\n  \\\\\r\n  X\\rightarrow Y,Y\\rightarrow Z, Y\\nrightarrow X, Z\\nsubseteq Y\r\n  \\\\\r\n  由BCNF定义Y必包含候选码，故有Y\\rightarrow X，\r\n  矛盾\r\n  $$\r\n\r\n- 4NF\r\n\r\n  所有非平凡函数依赖$X\\rightarrow \\rightarrow Y(Y\\nsubseteq X)$X都含有候选码\r\n  \r\n  所有二值关系至少是4NF\r\n  \r\n- 5NF\r\n\r\n1. 二元关系最高到4NF\r\n2. 全主属性3NF，不一定到BCNF\r\n3. 全码一定是BCNF，不一定是是4NF\r\n4. 只有一个主属性一定是2NF不一定是3NF\r\n5. 只有一个非主属性，不一定到2NF\r\n\r\n### 模式分解\r\n\r\n\r\n\r\n- 判断无损链接\r\n\r\n  - 方法一\r\n\r\n    1. 对每一个关系函数进行遍历，修改右侧，如果为a则都改为a\r\n    2. 出现同花顺停止，则为无损链接\r\n\r\n    ![](https://s2.loli.net/2022/01/23/nFf85HGJbatszqg.png)\r\n    \r\n  - 方法二\r\n  \r\n    $U_1\\bigcap U_2\\rightarrow U_1 - U_2 \\in F^+$\r\n\r\n1. 若进要求分解具有无损链接性则分解一定能达到4NF\r\n2. 若仅要求分解保持函数依赖，则分解一定能达到3NF\r\n3. 若已具有无损链接性又保持函数依赖则分解一定能达到3NF，不一定达到BCNF\r\n\r\n- 模式分解\r\n\r\n  ![](https://s2.loli.net/2022/01/23/E6nWTxUm35IbKY2.png)\r\n\r\n  \r\n\r\n  \r\n\r\n## 查询处理\r\n\r\n### 查询操作\r\n\r\n$\\begin{cases}嵌套循环链接\\\\排序-合并方法\\\\索引链接\\\\hash链接\\end{cases}$\r\n\r\n### 查询优化\r\n\r\n- 例\r\n\r\n  ![](https://s2.loli.net/2022/01/23/kDe6hjuSt741oFU.png)\r\n\r\n  ![](https://s2.loli.net/2022/01/23/rJXjKEhaZibgWnG.png)\r\n\r\n  ![](https://s2.loli.net/2022/01/23/XR9rEJzLeP3aiVW.png)\r\n\r\n  ![](https://s2.loli.net/2022/01/23/VUWfIvYxG1TlBPi.png)\r\n\r\n  \r\n  $$\r\n  嵌套循环代价：\\\\\r\n  读块数=Br+\\frac{Br\\cdot Bs}{K-2}\\\\\r\n  写块数=Br+\\frac{Br\\cdot Bs}{K-2}+\\frac{Frs\\cdot Nr\\cdot Ns}{Mrs}\\\\\\\r\n  索引扫描代价:\\\\\r\n  读块数=L+S\\\\\r\n  L:B+树层数\r\n  $$\r\n\r\n## 数据库恢复\r\n\r\n### 事务的特性ACID\r\n\r\n- 原子性\r\n-  一致性\r\n- 隔离性\r\n- 持续性\r\n\r\n### 故障\r\n\r\n- 事务故障  UNDO\r\n- 系统故障  UNDO+REDO\r\n- 介质故障  REDO\r\n- 计算机病毒\r\n\r\n### 恢复\r\n\r\n- 数据转储\r\n\r\n  - 静态转储 动态转储\r\n  - 海量转储 增量转储\r\n\r\n- 日志文件\r\n\r\n  1. 从检查点开始扫描日志，UNDO队列初始化为ACTIVE队列，REDO队列初始化为空\r\n  2. UNDO队列总每个事务从后向前扫描日志UNDO\r\n  3. REDO对立中每个事务从前向后扫描日志REDO\r\n\r\n  ![](https://s2.loli.net/2022/01/23/T3hvrLfx4zdON98.png)\r\n\r\n## 并发控制\r\n\r\n### 数据不一致性\r\n\r\n- 丢失更新\r\n- 读脏数据\r\n- 不可重复读\r\n\r\n### 三级封锁\r\n\r\n$\\begin{cases} X锁（写锁）\\\\ S锁（读锁）\\end{cases}$\r\n\r\n- 一级封锁协议\r\n\r\n  事务写之前加X锁\r\n\r\n  防止丢失更新\r\n\r\n- 二级封锁协议\r\n\r\n  事务写之前加X锁，读之前加S锁\r\n\r\n  防止丢失更新、读脏数据\r\n\r\n- 三级封锁协议\r\n\r\n  事务写之前加X锁，事务读之前加S锁\r\n\r\n  防止丢失更新、读脏数据、不可重复读\r\n\r\n- 活锁\r\n\r\n  解决：先来先服务\r\n\r\n- 死锁\r\n\r\n  $产生条件\\begin{cases}互斥\\\\不可剥夺\\\\部分分配\\\\环路\\end{cases}$\r\n\r\n**可串行化是并行事务正确性的唯一标准**\r\n\r\n**n个事务允许并发执行，最多有n种可能的正确结果**\r\n\r\n**冲突可串行化调度一定是可串行化调度**\r\n\r\n**不是冲突可串行化调度仍有可能是可串行化调度**\r\n\r\n### 并发调度可传行性\r\n\r\n不同事务，统一数据，读读操作可交换\r\n\r\n不同事物，不同数据，皆可交换\r\n\r\n\r\n\r\n### 两段锁\r\n\r\n读写之前先封锁\r\n\r\n释放封锁后不再申请锁\r\n\r\n**三级封锁是两段锁的特例**\r\n\r\n**两段锁协议是可串行化调度的充分不必要条件**\r\n\r\n\r\n\r\n### 多粒度封锁\r\n\r\n$\\Join$\r\n","frontmatter":{"date":"2021-01-08","description":"华中科技大学计算机学院数据库笔记","title":"[HUST]数据库","bg":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAADFklEQVQozxXR+08bdQAA8PtvXMwcLdfSe9/33nd93V1b2uu11+uL9mAtFHDjEYUVJQoxmWyKhvkYRpyDGI3EsAfZZJpMZtiyDWfGnFP0N8xiNJIgemf8/Asf6PDvPdf93fN+c92fPO/hP4f3/3x60zvYdv964B082n9679cfvtq5d/nOzdUHt69s31rbvnVp88bq+qVP1lYvQp6377l77r9PXPex5+143o97v1w+3L/jHXz/x+7G9eWzb786tPzmC69Nti6+M7N24czGZwtb15Y31z++/vkitLO59Hhzcevqwt2Nxd3vVpYWpn7een/3xhtbH7U/GC28NWRNN82pVqFhqdV0xNQVBmCNXvv8/Mx787PQtyunvv5w4tO51pVzo1fPj5dU4fWxyun+ZEVlYzwpcxTPkpLAsgzJAhxQGEGhuiaPD9ZHWg705Jv5L86d/PLCqfvX5ubaVQ4LNCrpatGIylyEo0kUCQTgjo5jnbDPD/uO+TtCKGwaulMulHI5aH1l8uxk+fSUs/TuWNlQwiyuKWzNSsckgSIJmiIIHIFhPwz7Q10wjgS1KF+1jZ5i3inb0Jnp5uyEM9BrvtI+XrG0ZIyz0tH2idpII99X6DaTUVEAogAUEcgCpch0WCZavfnpsWajakEtpzJQLzXqxVazWrbTaLAzk4qcfL7WathTw/Xx/qqZieuqFI/yelxIqIIWY/p6jJkXB0eaFaiQTdXsfCGbsoxUOqHiXXA8KlaLZq2UPdG0nVKG52gjrdpZvb9mjg/ag8et4WZxdKBnYsiBElo4l0mlEqppaCk9SqEhNSLauWRClTEk+MyRIwDQBStrdCeSSVXVZU3nTTOezydNMwVJIvf/A4ErkhBReKSrU5bAcCMnC3RCkwq5OMsDUZHCYUmReUHilAgT1kWgMEESgWiKwDAUwzCWZQCgUSTIcXRfT2Z2wnl5sm/mpf72aL1Zy4cVnmMpXuRwCvMFfT7ED0QSwjCUpkkGAJIgSBJHkFAIQUiKjEV4WWQYhs52x2t2WhIASaA4HgoE/M8+d/Qo3MFK1H+x0UpQsppjdQAAAABJRU5ErkJggg==","aspectRatio":1.5748031496062993,"src":"/static/b8bb133f4939a574c9cdbb38cf79f579/ee604/plane.png","srcSet":"/static/b8bb133f4939a574c9cdbb38cf79f579/69585/plane.png 200w,\n/static/b8bb133f4939a574c9cdbb38cf79f579/497c6/plane.png 400w,\n/static/b8bb133f4939a574c9cdbb38cf79f579/ee604/plane.png 800w,\n/static/b8bb133f4939a574c9cdbb38cf79f579/f3583/plane.png 1200w,\n/static/b8bb133f4939a574c9cdbb38cf79f579/5707d/plane.png 1600w,\n/static/b8bb133f4939a574c9cdbb38cf79f579/ed396/plane.png 2000w","sizes":"(max-width: 800px) 100vw, 800px"}}}}},"defaultImg":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHateUxEv/EABoQAAIDAQEAAAAAAAAAAAAAAAECAAMREhP/2gAIAQEAAQUCdYgxg9YCg2DjR4pP/8QAFhEBAQEAAAAAAAAAAAAAAAAAABES/9oACAEDAQE/Aco//8QAFhEBAQEAAAAAAAAAAAAAAAAAABMB/9oACAECAQE/AaYq/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAEyESEiMUH/2gAIAQEABj8CRm7EkSKcNH//xAAcEAACAgIDAAAAAAAAAAAAAAABEQAhMWFxkbH/2gAIAQEAAT8hxgm6Ea8B+QVHbAhkA3UNudmMxGROzP/aAAwDAQACAAMAAAAQ8C//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPxAj/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPxBqwg//xAAbEAEBAQEAAwEAAAAAAAAAAAABESEAMVGBYf/aAAgBAQABPxCdlMOWeYdckOKwFN+jfnWTzNDOaskA0T94QtGgFft4zI+ivf/Z","aspectRatio":1.6,"src":"/static/626eca6df3146e4daf0b83c44fe7548e/14b42/6.jpg","srcSet":"/static/626eca6df3146e4daf0b83c44fe7548e/f836f/6.jpg 200w,\n/static/626eca6df3146e4daf0b83c44fe7548e/2244e/6.jpg 400w,\n/static/626eca6df3146e4daf0b83c44fe7548e/14b42/6.jpg 800w,\n/static/626eca6df3146e4daf0b83c44fe7548e/47498/6.jpg 1200w,\n/static/626eca6df3146e4daf0b83c44fe7548e/a6974/6.jpg 1536w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"pageContext":{"fileAbsolutePath":"D:/Project/HomePage/chi-s-page-0/static/blog/Engineering/Computer/DataBase/hust_database.md"}},
    "staticQueryHashes": []}